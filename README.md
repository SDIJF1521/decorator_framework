# ğŸ­ è£…é¥°å™¨æ¡†æ¶ - Pythonä¼ä¸šçº§å¼€å‘æ¡†æ¶

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„Pythonè£…é¥°å™¨æ¡†æ¶ï¼Œæä¾›**ä¾èµ–æ³¨å…¥**ã€**è°ƒç”¨é“¾æ‹¦æˆª**ã€**ä»»åŠ¡ç®¡ç†**å’Œ**ä¼˜å…ˆçº§é˜Ÿåˆ—**ç­‰é«˜çº§åŠŸèƒ½ã€‚æ”¯æŒäº‹ä»¶è§¦å‘ã€å‘½ä»¤å¤„ç†ã€å®šæ—¶ä»»åŠ¡å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚

## ğŸ“‹ ç›®å½•

- [ğŸ­ è£…é¥°å™¨æ¡†æ¶ - Pythonä¼ä¸šçº§å¼€å‘æ¡†æ¶](#-è£…é¥°å™¨æ¡†æ¶---pythonä¼ä¸šçº§å¼€å‘æ¡†æ¶)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [âœ… æ¡†æ¶çŠ¶æ€](#-æ¡†æ¶çŠ¶æ€)
  - [ğŸ¯ æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
  - [ğŸŒ æ–‡æ¡£è¯­è¨€](#-æ–‡æ¡£è¯­è¨€)
  - [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
    - [0. ç¯å¢ƒå‡†å¤‡](#0-ç¯å¢ƒå‡†å¤‡)
    - [1. å®‰è£…æ¡†æ¶](#1-å®‰è£…æ¡†æ¶)
    - [2. åŸºç¡€æ¦‚å¿µ](#2-åŸºç¡€æ¦‚å¿µ)
      - [æ¡†æ¶é›†æˆå¯ç”¨](#æ¡†æ¶é›†æˆå¯ç”¨)
      - [æœåŠ¡è£…é¥°å™¨ç”¨æ³•](#æœåŠ¡è£…é¥°å™¨ç”¨æ³•)
      - [äº‹ä»¶è£…é¥°å™¨ç”¨æ³•](#äº‹ä»¶è£…é¥°å™¨ç”¨æ³•)
    - [3. åŸºç¡€ç¤ºä¾‹](#3-åŸºç¡€ç¤ºä¾‹)
    - [4. é«˜çº§å‚æ•°è§£æç¤ºä¾‹](#4-é«˜çº§å‚æ•°è§£æç¤ºä¾‹)
    - [6. è°ƒç”¨é“¾ç³»ç»Ÿ](#6-è°ƒç”¨é“¾ç³»ç»Ÿ)
      - [è‡ªåŠ¨è°ƒç”¨é“¾é›†æˆ](#è‡ªåŠ¨è°ƒç”¨é“¾é›†æˆ)
      - [è‡ªå®šä¹‰æ‹¦æˆªå™¨](#è‡ªå®šä¹‰æ‹¦æˆªå™¨)
    - [ğŸ“Š ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ](#-ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ)
      - [åŸºæœ¬ä»»åŠ¡ç®¡ç†](#åŸºæœ¬ä»»åŠ¡ç®¡ç†)
      - [ä»»åŠ¡ç»Ÿè®¡å’Œç›‘æ§](#ä»»åŠ¡ç»Ÿè®¡å’Œç›‘æ§)
    - [8. äº‹ä»¶è£…é¥°å™¨ç³»ç»Ÿ](#8-äº‹ä»¶è£…é¥°å™¨ç³»ç»Ÿ)
      - [æ™®é€šäº‹ä»¶å¤„ç† (@on)](#æ™®é€šäº‹ä»¶å¤„ç†-on)
      - [å‘½ä»¤å¤„ç† (@command\_on)](#å‘½ä»¤å¤„ç†-command_on)
      - [å®šæ—¶ä»»åŠ¡ (@time\_on)](#å®šæ—¶ä»»åŠ¡-time_on)
      - [æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… (@re\_on)](#æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…-re_on)
    - [9. ä¼˜å…ˆçº§é˜Ÿåˆ—ç³»ç»Ÿ](#9-ä¼˜å…ˆçº§é˜Ÿåˆ—ç³»ç»Ÿ)
      - [åŸºæœ¬ä½¿ç”¨](#åŸºæœ¬ä½¿ç”¨)
      - [èµ„æºæ§åˆ¶](#èµ„æºæ§åˆ¶)
  - [10. æ¶æ„è®¾è®¡](#10-æ¶æ„è®¾è®¡)
    - [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
    - [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)
  - [11. æœ€ä½³å®è·µ](#11-æœ€ä½³å®è·µ)
    - [1. æœåŠ¡è®¾è®¡](#1-æœåŠ¡è®¾è®¡)
    - [2. é”™è¯¯å¤„ç†](#2-é”™è¯¯å¤„ç†)
    - [3. æ€§èƒ½ä¼˜åŒ–](#3-æ€§èƒ½ä¼˜åŒ–)
  - [12. é«˜çº§ç”¨æ³•](#12-é«˜çº§ç”¨æ³•)
    - [1. è‡ªå®šä¹‰å‚æ•°è§£æå™¨](#1-è‡ªå®šä¹‰å‚æ•°è§£æå™¨)
      - [æ™ºèƒ½å‚æ•°è§£æå™¨å®ç°](#æ™ºèƒ½å‚æ•°è§£æå™¨å®ç°)
    - [2. å¤šäº‹ä»¶ç›‘å¬å™¨æ¨¡å¼](#2-å¤šäº‹ä»¶ç›‘å¬å™¨æ¨¡å¼)
    - [3. æ¡ä»¶äº‹ä»¶å¤„ç†](#3-æ¡ä»¶äº‹ä»¶å¤„ç†)
    - [4. åŠ¨æ€æœåŠ¡æ³¨å†Œ](#4-åŠ¨æ€æœåŠ¡æ³¨å†Œ)
    - [5. ä»»åŠ¡æµæ°´çº¿](#5-ä»»åŠ¡æµæ°´çº¿)
    - [6. äº‹ä»¶é©±åŠ¨æ¶æ„](#6-äº‹ä»¶é©±åŠ¨æ¶æ„)
  - [13. æ¡†æ¶æ ¸å¿ƒåŠŸèƒ½è¯¦è§£](#13-æ¡†æ¶æ ¸å¿ƒåŠŸèƒ½è¯¦è§£)
    - [å‚æ•°è§£æç³»ç»Ÿ](#å‚æ•°è§£æç³»ç»Ÿ)
      - [åŸºç¡€å‚æ•°è§£æ](#åŸºç¡€å‚æ•°è§£æ)
      - [é«˜çº§å‚æ•°è§£æ](#é«˜çº§å‚æ•°è§£æ)
      - [æ™ºèƒ½å‚æ•°è§£æå™¨](#æ™ºèƒ½å‚æ•°è§£æå™¨)
      - [å‚æ•°è§£æå™¨ç‰¹æ€§](#å‚æ•°è§£æå™¨ç‰¹æ€§)
  - [14. å‚æ•°å‚è€ƒ](#14-å‚æ•°å‚è€ƒ)
    - [@service è£…é¥°å™¨å‚æ•°](#service-è£…é¥°å™¨å‚æ•°)
    - [@on è£…é¥°å™¨å‚æ•°](#on-è£…é¥°å™¨å‚æ•°)
    - [@command\_on è£…é¥°å™¨å‚æ•°](#command_on-è£…é¥°å™¨å‚æ•°)
    - [@time\_on è£…é¥°å™¨å‚æ•°](#time_on-è£…é¥°å™¨å‚æ•°)
    - [@re\_on è£…é¥°å™¨å‚æ•°](#re_on-è£…é¥°å™¨å‚æ•°)
  - [15. æµ‹è¯•éªŒè¯](#15-æµ‹è¯•éªŒè¯)
    - [è¿è¡Œæ‰€æœ‰æµ‹è¯•](#è¿è¡Œæ‰€æœ‰æµ‹è¯•)
    - [è¿è¡Œç‰¹å®šç¤ºä¾‹](#è¿è¡Œç‰¹å®šç¤ºä¾‹)
    - [æ€§èƒ½æµ‹è¯•](#æ€§èƒ½æµ‹è¯•)
  - [16. æ•…éšœæ’é™¤](#16-æ•…éšœæ’é™¤)
    - [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
      - [1. ModuleNotFoundError: No module named 'nucleus'](#1-modulenotfounderror-no-module-named-nucleus)
      - [2. è£…é¥°å™¨ä¸ç”Ÿæ•ˆ](#2-è£…é¥°å™¨ä¸ç”Ÿæ•ˆ)
      - [3. ä¾èµ–æ³¨å…¥å¤±è´¥](#3-ä¾èµ–æ³¨å…¥å¤±è´¥)
    - [4. å‘½ä»¤å‚æ•°ç±»å‹é”™è¯¯](#4-å‘½ä»¤å‚æ•°ç±»å‹é”™è¯¯)
    - [5. è‡ªå®šä¹‰å‚æ•°è§£æå™¨é”™è¯¯](#5-è‡ªå®šä¹‰å‚æ•°è§£æå™¨é”™è¯¯)
    - [6. äº‹ä»¶ä¸è§¦å‘](#6-äº‹ä»¶ä¸è§¦å‘)
    - [7. å‚æ•°è§£æå™¨ç±»å‹é”™è¯¯](#7-å‚æ•°è§£æå™¨ç±»å‹é”™è¯¯)
    - [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)
      - [1. æ£€æŸ¥æœåŠ¡æ³¨å†ŒçŠ¶æ€](#1-æ£€æŸ¥æœåŠ¡æ³¨å†ŒçŠ¶æ€)
      - [2. æ£€æŸ¥äº‹ä»¶å¤„ç†å™¨](#2-æ£€æŸ¥äº‹ä»¶å¤„ç†å™¨)
      - [3. ä»»åŠ¡çŠ¶æ€æ£€æŸ¥](#3-ä»»åŠ¡çŠ¶æ€æ£€æŸ¥)
  - [17. ç›¸å…³æ–‡æ¡£](#17-ç›¸å…³æ–‡æ¡£)
  - [18. è´¡çŒ®æŒ‡å—](#18-è´¡çŒ®æŒ‡å—)
  - [19. è®¸å¯è¯](#19-è®¸å¯è¯)
  - [20. æ”¯æŒ](#20-æ”¯æŒ)
  - [18. è´¡çŒ®æŒ‡å—](#18-è´¡çŒ®æŒ‡å—-1)
    - [ğŸ¯ è´¡çŒ®æ–¹å¼](#-è´¡çŒ®æ–¹å¼)
    - [ğŸ“ è´¡çŒ®æ­¥éª¤](#-è´¡çŒ®æ­¥éª¤)
    - [ğŸ“‹ ä»£ç è§„èŒƒ](#-ä»£ç è§„èŒƒ)
  - [21. æ›´æ–°æ—¥å¿—](#21-æ›´æ–°æ—¥å¿—)
    - [v2.4.0 (å½“å‰ç‰ˆæœ¬)](#v240-å½“å‰ç‰ˆæœ¬)
    - [v2.3.0](#v230)
    - [v2.2.0](#v220)
    - [v2.1.0](#v210)
  - [19. è®¸å¯è¯](#19-è®¸å¯è¯-1)
    - [ğŸ“ è”ç³»æ–¹å¼](#-è”ç³»æ–¹å¼)
    - [ğŸ™ è‡´è°¢](#-è‡´è°¢)

## âœ… æ¡†æ¶çŠ¶æ€

**æµ‹è¯•çŠ¶æ€**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ (44/44) - æ¡†æ¶åŠŸèƒ½å®Œæ•´ä¸”ç¨³å®š  
**æ–‡æ¡£çŠ¶æ€**: âœ… æ–‡æ¡£å·²æ›´æ–° - åŸºäºå®é™…æºç éªŒè¯  
**ä¾èµ–çŠ¶æ€**: âœ… é›¶ç¬¬ä¸‰æ–¹ä¾èµ– - ä»…ä½¿ç”¨Pythonæ ‡å‡†åº“  
**å…¼å®¹æ€§**: âœ… Python 3.8+  

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **ğŸ”§ é›¶ä¾èµ–**: ä»…ä½¿ç”¨Pythonæ ‡å‡†åº“ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–
- **âš¡ é«˜æ€§èƒ½**: å¼‚æ­¥æ”¯æŒï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œèµ„æºæ§åˆ¶
- **ğŸ—ï¸ ä¼ä¸šçº§**: ä¾èµ–æ³¨å…¥ï¼ŒæœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ¥å£æ˜ å°„
- **ğŸ”— è°ƒç”¨é“¾**: æ‹¦æˆªå™¨æ¨¡å¼ï¼Œä¸Šä¸‹æ–‡ä¼ é€’ï¼Œæ€§èƒ½ç›‘æ§
- **ğŸ“Š ä»»åŠ¡ç®¡ç†**: å®šæ—¶ä»»åŠ¡ï¼Œå¹¶å‘æ§åˆ¶ï¼Œä»»åŠ¡ç»Ÿè®¡
- **ğŸ¨ è£…é¥°å™¨API**: ç®€æ´ä¼˜é›…ï¼Œç±»å‹å®‰å…¨ï¼Œæ˜“äºä½¿ç”¨

## ğŸŒ æ–‡æ¡£è¯­è¨€
- [English Version](EN_README.md) - è‹±æ–‡æ–‡æ¡£
- [ä¸­æ–‡ç‰ˆæœ¬](README.md) - å½“å‰æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 0. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿Pythonç‰ˆæœ¬ >= 3.7ï¼Œå®‰è£…æ¡†æ¶ä¾èµ–ï¼š

```bash
pip install asyncio
```

### 1. å®‰è£…æ¡†æ¶

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/decorator_framework.git
cd decorator_framework

# è¿è¡Œç¤ºä¾‹
python examples/basic_example.py
```

**éªŒè¯å®‰è£…:**
```bash
# è¿è¡Œæµ‹è¯•éªŒè¯æ¡†æ¶åŠŸèƒ½
python -m pytest tests/ -v
# é¢„æœŸè¾“å‡º: 44 passed, 0 failed

# è¿è¡Œå¿«é€Ÿå¼€å§‹ç¤ºä¾‹
python examples/quick_start_example.py
```

### 2. åŸºç¡€æ¦‚å¿µ

#### æ¡†æ¶é›†æˆå¯ç”¨
åœ¨ä»»ä½•è£…é¥°å™¨ä½¿ç”¨å‰ï¼Œå¿…é¡»å…ˆå¯ç”¨æ¡†æ¶é›†æˆï¼š

```python
from nucleus.core.integration import enable_framework_integration

# å¯ç”¨æ¡†æ¶é›†æˆï¼ˆå¿…é¡»å…ˆè°ƒç”¨ï¼‰
enable_framework_integration()
```

#### æœåŠ¡è£…é¥°å™¨ç”¨æ³•
**é‡è¦**: `@service`è£…é¥°å™¨**ä¸éœ€è¦**`.execute()`æ–¹æ³•ï¼

```python
from nucleus.core.integration import service

# âœ… æ­£ç¡®ç”¨æ³• - ç›´æ¥è£…é¥°ç±»
@service('singleton')  # æˆ– @service() é»˜è®¤ä¸ºå•ä¾‹
class MyService:
    def do_something(self):
        return "Hello World"

# âœ… ä¹Ÿæ”¯æŒæ¥å£æ˜ å°„
@service(IMyService)  # æ³¨å†Œæ¥å£åˆ°å®ç°çš„æ˜ å°„
class MyServiceImpl(IMyService):
    def do_something(self):
        return "Hello World"
```

#### äº‹ä»¶è£…é¥°å™¨ç”¨æ³•
**é‡è¦**: `@on`ã€`@command_on`ã€`@time_on`ã€`@re_on`è£…é¥°å™¨**å¿…é¡»**ä½¿ç”¨`.execute()`æ–¹æ³•ï¼

```python
from decorators import on, command_on

# âœ… æ­£ç¡®ç”¨æ³• - å¿…é¡»ä½¿ç”¨.execute()
@on("user_login").execute()
async def handle_login(user_id: str):
    print(f"ç”¨æˆ· {user_id} ç™»å½•äº†")

# âœ… å‘½ä»¤è£…é¥°å™¨ä¹Ÿéœ€è¦.execute()
@command_on("bot", "/hello").execute()
async def handle_hello_command():
    return "Hello!"

# âŒ é”™è¯¯ç”¨æ³• - ç¼ºå°‘.execute()
@on("user_login")  # è¿™æ ·ä¼šæ³¨å†Œå¤±è´¥
def handle_login():
    pass
```

### 3. åŸºç¡€ç¤ºä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„å…¥é—¨ç¤ºä¾‹ï¼Œå±•ç¤ºæ¡†æ¶çš„æ­£ç¡®ç”¨æ³•ï¼š

```python
import asyncio
import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„ï¼ˆå¦‚æœåœ¨é¡¹ç›®å¤–è¿è¡Œï¼‰
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from nucleus.core.integration import enable_framework_integration, service, inject
from decorators import on, command_on
from nucleus.dispatcher import EventDispatcher

# 1. å¯ç”¨æ¡†æ¶é›†æˆï¼ˆå¿…é¡»å…ˆè°ƒç”¨ï¼‰
enable_framework_integration()

# 2. å®šä¹‰æœåŠ¡æ¥å£å’Œå®ç°
class IDataService:
    async def get_user_name(self, user_id: str) -> str:
        raise NotImplementedError

@service(IDataService)  # æ³¨å†Œæ¥å£åˆ°å®ç°çš„æ˜ å°„
class DataService(IDataService):
    def __init__(self):
        self.users = {"1": "å¼ ä¸‰", "2": "æå››"}
    
    async def get_user_name(self, user_id: str) -> str:
        return self.users.get(user_id, "æœªçŸ¥ç”¨æˆ·")

# 3. å®šä¹‰ä¸šåŠ¡æœåŠ¡ï¼ˆè‡ªåŠ¨ä¾èµ–æ³¨å…¥ï¼‰
@service('singleton')
class UserService:
    def __init__(self, data_service: IDataService):
        self.data_service = data_service
    
    async def greet_user(self, user_id: str) -> str:
        user_name = await self.data_service.get_user_name(user_id)
        return f"ä½ å¥½ï¼Œ{user_name}ï¼"

# 4. äº‹ä»¶å¤„ç†ï¼ˆä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼‰
@on("user_login").execute()
async def handle_user_login(user_service: UserService, user_id: str, ip: str):
    greeting = await user_service.greet_user(user_id)
    print(f"ğŸ‰ {greeting} (æ¥è‡ªIP: {ip})")

# 5. å‘½ä»¤å¤„ç†
@command_on("bot", "/greet").execute()
async def handle_greet_command(user_service: UserService, user_id: str = "1"):
    greeting = await user_service.greet_user(user_id)
    return greeting

# 6. ä¸»æ¼”ç¤ºå‡½æ•°
async def main():
    print("ğŸš€ è£…é¥°å™¨æ¡†æ¶æ¼”ç¤ºå¼€å§‹...")
    
    # è·å–æœåŠ¡å®ä¾‹
    user_service = UserService(DataService())
    
    # æµ‹è¯•ä¸šåŠ¡é€»è¾‘
    greeting = await user_service.greet_user("1")
    print(f"ä¸šåŠ¡æµ‹è¯•: {greeting}")
    
    # æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ
    dispatcher = EventDispatcher()
    await dispatcher.trigger_event("user_login", user_id="1", ip="192.168.1.1")
    
    # æµ‹è¯•å‘½ä»¤ç³»ç»Ÿ
    from nucleus.dispatcher import DecisionCommandDispatcher
    cmd_dispatcher = DecisionCommandDispatcher()
    result = await cmd_dispatcher.handle("/greet", user_id="2")
    print(f"å‘½ä»¤ç»“æœ: {result}")
    
    print("\nâœ… æ¼”ç¤ºå®Œæˆï¼")

if __name__ == "__main__":
    asyncio.run(main())
```

**é¢„æœŸè¾“å‡º:**
```
ğŸš€ è£…é¥°å™¨æ¡†æ¶æ¼”ç¤ºå¼€å§‹...
ä¸šåŠ¡æµ‹è¯•: ä½ å¥½ï¼Œå¼ ä¸‰ï¼
ğŸ‰ ä½ å¥½ï¼Œå¼ ä¸‰ï¼ (æ¥è‡ªIP: 192.168.1.1)
å‘½ä»¤ç»“æœ: ä½ å¥½ï¼Œæå››ï¼

âœ… æ¼”ç¤ºå®Œæˆï¼
```

### 4. é«˜çº§å‚æ•°è§£æç¤ºä¾‹

```python
import asyncio
import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from nucleus.core.integration import enable_framework_integration, service
from decorators import command_on
from nucleus.dispatcher import DecisionCommandDispatcher

# å¯ç”¨æ¡†æ¶é›†æˆ
enable_framework_integration()

# æ™ºèƒ½å‚æ•°è§£æå™¨
def smart_arg_parser(args_str: str) -> dict:
    """æ™ºèƒ½å‚æ•°è§£æå™¨ - æ”¯æŒå¤šç§å‚æ•°æ ¼å¼"""
    result = {}
    
    # 1. JSONæ ¼å¼è§£æ
    if args_str.strip().startswith('{'):
        try:
            import json
            return json.loads(args_str)
        except json.JSONDecodeError:
            pass
    
    # 2. key=value æ ¼å¼è§£æ
    if '=' in args_str:
        pairs = args_str.split()
        for pair in pairs:
            if '=' in pair:
                key, value = pair.split('=', 1)
                # è‡ªåŠ¨ç±»å‹æ¨æ–­
                if value.lower() in ('true', 'false'):
                    result[key] = value.lower() == 'true'
                elif value.isdigit():
                    result[key] = int(value)
                elif value.replace('.', '').isdigit():
                    result[key] = float(value)
                elif value.startswith('"') and value.endswith('"'):
                    result[key] = value[1:-1]  # ç§»é™¤å¼•å·
                else:
                    result[key] = value
        return result
    
    # 3. ä½ç½®å‚æ•°è§£æ
    parts = args_str.strip().split()
    if parts:
        result['args'] = parts
    
    return result

# ç”¨æˆ·æœåŠ¡
@service('singleton')
class UserService:
    def __init__(self):
        self.users = {
            "1": {"name": "å¼ ä¸‰", "age": 25, "active": True},
            "2": {"name": "æå››", "age": 30, "active": False},
            "3": {"name": "ç‹äº”", "age": 28, "active": True}
        }
    
    async def get_user(self, user_id: str):
        return self.users.get(user_id)
    
    async def search_users(self, **filters):
        """æ ¹æ®æ¡ä»¶æœç´¢ç”¨æˆ·"""
        results = []
        for user_id, user in self.users.items():
            match = True
            for key, value in filters.items():
                if key in user and user[key] != value:
                    match = False
                    break
            if match:
                results.append({"id": user_id, **user})
        return results

# æ™ºèƒ½å‘½ä»¤å¤„ç† - æ”¯æŒJSONæ ¼å¼å‚æ•°
@command_on("smart", "/user", arg_parser=smart_arg_parser).execute()
async def handle_user_command(user_service: UserService, **kwargs):
    """å¤„ç†æ™ºèƒ½å‚æ•°è§£æå‘½ä»¤"""
    # kwargsåŒ…å«äº†è§£æåçš„å‚æ•°
    if 'id' in kwargs:
        user = await user_service.get_user(kwargs['id'])
        if user:
            return f"ç”¨æˆ·ä¿¡æ¯: {user['name']}, å¹´é¾„: {user['age']}, çŠ¶æ€: {'æ´»è·ƒ' if user['active'] else 'éæ´»è·ƒ'}"
        return "ç”¨æˆ·ä¸å­˜åœ¨"
    elif 'active' in kwargs or 'age' in kwargs:
        # æœç´¢ç”¨æˆ·
        users = await user_service.search_users(**kwargs)
        if users:
            user_list = ", ".join([f"{u['name']}({u['id']})" for u in users])
            return f"æ‰¾åˆ° {len(users)} ä¸ªç”¨æˆ·: {user_list}"
        return "æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·"
    else:
        return f"æ”¶åˆ°å‚æ•°: {kwargs}ï¼Œæ”¯æŒå‚æ•°: id=<ç”¨æˆ·ID>, active=<true|false>, age=<å¹´é¾„>"

# ä¸»æ¼”ç¤ºå‡½æ•°
async def main():
    print("ğŸš€ é«˜çº§å‚æ•°è§£ææ¼”ç¤ºå¼€å§‹...")
    
    dispatcher = DecisionCommandDispatcher()
    
    # æµ‹è¯•ä¸åŒçš„å‚æ•°æ ¼å¼
    test_commands = [
        '/user {"id": "1"}',                    # JSONæ ¼å¼
        '/user id=2',                           # key=valueæ ¼å¼
        '/user active=true',                    # å¸ƒå°”å€¼è‡ªåŠ¨æ¨æ–­
        '/user age=25',                         # æ•°å€¼ç±»å‹
        '/user active=true age=28',             # å¤šæ¡ä»¶ç»„åˆ
        '/user id="3"',                         # å¸¦å¼•å·å­—ç¬¦ä¸²
    ]
    
    for cmd in test_commands:
        print(f"\næ‰§è¡Œå‘½ä»¤: {cmd}")
        result = await dispatcher.handle(cmd)
        print(f"ç»“æœ: {result}")
    
    print("\nâœ… é«˜çº§å‚æ•°è§£ææ¼”ç¤ºå®Œæˆï¼")

if __name__ == "__main__":
    asyncio.run(main())

## ğŸ“– æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 5. ä¾èµ–æ³¨å…¥ç³»ç»Ÿ



#### æœåŠ¡æ³¨å†Œæ–¹å¼



```python
from nucleus.core.integration import service, enable_framework_integration

enable_framework_integration()

# 1. åŸºæœ¬æœåŠ¡æ³¨å†Œï¼ˆå•ä¾‹ï¼‰
@service('singleton')
class DatabaseService:
    def __init__(self):
        self.connection = "æ•°æ®åº“è¿æ¥"

# 2. æ¥å£æ˜ å°„æ³¨å†Œ
class IDatabaseService:
    def query(self, sql: str): pass

@service(IDatabaseService)  # è‡ªåŠ¨æ³¨å†Œæ¥å£åˆ°å®ç°çš„æ˜ å°„
class MySQLService(IDatabaseService):
    def query(self, sql: str):
        return f"æ‰§è¡ŒSQL: {sql}"

# 3. ç”Ÿå‘½å‘¨æœŸé€‰é¡¹
@service('transient')  # æ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹
class TransientService:
    pass

@service('scoped')     # ä½œç”¨åŸŸå†…å•ä¾‹
class ScopedService:
    pass
```

### 6. è°ƒç”¨é“¾ç³»ç»Ÿ

æ¡†æ¶å†…ç½®è°ƒç”¨é“¾æœºåˆ¶ï¼Œæ”¯æŒæ‹¦æˆªå™¨æ¨¡å¼å’Œä¸Šä¸‹æ–‡ä¼ é€’ã€‚

#### è‡ªåŠ¨è°ƒç”¨é“¾é›†æˆ

æ‰€æœ‰ä½¿ç”¨æ¡†æ¶è£…é¥°å™¨çš„å‡½æ•°éƒ½ä¼šè‡ªåŠ¨é€šè¿‡è°ƒç”¨é“¾æ‰§è¡Œï¼š

```python
from decorators import on

@on("data_processing").execute()
async def process_data(data_service: IDataService, raw_data: str):
    # è¿™ä¸ªå‡½æ•°ä¼šè‡ªåŠ¨é€šè¿‡è°ƒç”¨é“¾æ‰§è¡Œ
    # æ”¯æŒä¾èµ–æ³¨å…¥ã€æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ç­‰
    processed = await data_service.process(raw_data)
    return processed
```

#### è‡ªå®šä¹‰æ‹¦æˆªå™¨

```python
from nucleus.core.chain import ChainInterceptor, ChainContext

class CustomInterceptor(ChainInterceptor):
    async def before_execute(self, context: ChainContext):
        print(f"å¼€å§‹æ‰§è¡Œ: {context.function_name}")
    
    async def after_execute(self, context: ChainContext):
        print(f"æ‰§è¡Œå®Œæˆ: {context.function_name}")
    
    async def on_error(self, context: ChainContext, error: Exception):
        print(f"æ‰§è¡Œé”™è¯¯: {context.function_name}, é”™è¯¯: {error}")

# æ·»åŠ è‡ªå®šä¹‰æ‹¦æˆªå™¨
from nucleus.core.integration import get_framework_integration
integration = get_framework_integration()
integration.add_chain_interceptor(CustomInterceptor())
```

### ğŸ“Š ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

æ¡†æ¶æä¾›å¼ºå¤§çš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒå¼‚æ­¥ä»»åŠ¡è°ƒåº¦å’Œç›‘æ§ã€‚

#### åŸºæœ¬ä»»åŠ¡ç®¡ç†

```python
from nucleus.core.integration import get_task_manager, enable_framework_integration

enable_framework_integration()
task_manager = get_task_manager()

# åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
async def long_running_task(task_name: str, duration: float):
    print(f"å¼€å§‹ä»»åŠ¡: {task_name}")
    await asyncio.sleep(duration)
    print(f"å®Œæˆä»»åŠ¡: {task_name}")
    return f"ä»»åŠ¡ {task_name} å®Œæˆ"

# ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨åˆ›å»ºä»»åŠ¡
task_id = task_manager.create_task(
    long_running_task("æ•°æ®å¤„ç†", 2.0),
    name="æ•°æ®å¤„ç†ä»»åŠ¡",
    metadata={"user_id": "123", "priority": "high"}
)

# ç­‰å¾…ä»»åŠ¡å®Œæˆ
result = await task_manager.wait_for_task_async(task_id)
print(f"ä»»åŠ¡ç»“æœ: {result}")
```

#### ä»»åŠ¡ç»Ÿè®¡å’Œç›‘æ§

```python
# è·å–ä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯
stats = task_manager.get_statistics()
print(f"æ€»ä»»åŠ¡æ•°: {stats['total_tasks']}")
print(f"æ´»è·ƒä»»åŠ¡: {stats['active_tasks']}")
print(f"å®Œæˆä»»åŠ¡: {stats['completed_tasks']}")
print(f"å¤±è´¥ä»»åŠ¡: {stats['failed_tasks']}")

# è·å–å…·ä½“ä»»åŠ¡ä¿¡æ¯
task_info = task_manager.get_task_info(task_id)
if task_info:
    print(f"ä»»åŠ¡çŠ¶æ€: {task_info['status']}")
    print(f"æ‰§è¡Œæ—¶é—´: {task_info['duration']}ç§’")
    print(f"ç­‰å¾…æ—¶é—´: {task_info['wait_time']}ç§’")
```

### 8. äº‹ä»¶è£…é¥°å™¨ç³»ç»Ÿ

æ¡†æ¶æä¾›å¤šç§äº‹ä»¶è£…é¥°å™¨ï¼Œæ”¯æŒä¸åŒç±»å‹çš„äº‹ä»¶å¤„ç†ã€‚

#### æ™®é€šäº‹ä»¶å¤„ç† (@on)

```python
from decorators import on

@on("user_login").execute()
async def handle_login(user_id: str, ip: str, user_service: UserService):
    # æ”¯æŒä¾èµ–æ³¨å…¥
    user = await user_service.get_user(user_id)
    print(f"ç”¨æˆ· {user.name} ä» {ip} ç™»å½•")

# è§¦å‘äº‹ä»¶
from nucleus.dispatcher import EventDispatcher
dispatcher = EventDispatcher()
await dispatcher.trigger_event("user_login", user_id="123", ip="192.168.1.1")
```

#### å‘½ä»¤å¤„ç† (@command_on)

```python
from decorators import command_on

@command_on("bot", "/start", aliases=["/begin"], cooldown=5).execute()
async def handle_start_command(user_id: str):
    return "æ¬¢è¿ä½¿ç”¨æœºå™¨äººï¼"

@command_on("bot", "/help").execute()
async def handle_help_command():
    return "å¯ç”¨å‘½ä»¤: /start, /help, /status"

# å¸¦å‚æ•°çš„å‘½ä»¤å¤„ç†
@command_on("greet", "/greet").execute()
async def handle_greet_command(user_service: UserService, args: list = None):
    """å¤„ç†é—®å€™å‘½ä»¤ - argså‚æ•°å¿…é¡»æ˜¯listç±»å‹"""
    if args is None:
        args = []
    user_id = args[0] if args else "1"
    user = await user_service.get_user_by_id(user_id)
    return f"ä½ å¥½ï¼Œ{user['name']}ï¼"

# æ‰§è¡Œå‘½ä»¤
from nucleus.dispatcher import DecisionCommandDispatcher
cmd_dispatcher = DecisionCommandDispatcher()
result = await cmd_dispatcher.execute_command("/start", user_id="123")
print(result)  # è¾“å‡º: æ¬¢è¿ä½¿ç”¨æœºå™¨äººï¼

# æ‰§è¡Œå¸¦å‚æ•°çš„å‘½ä»¤
result = await cmd_dispatcher.execute_command("/greet 2")
print(result)  # è¾“å‡º: ä½ å¥½ï¼Œæå››ï¼
```

#### å®šæ—¶ä»»åŠ¡ (@time_on)

```python
from decorators import time_on

@time_on("heartbeat", interval=60, priority=1).execute()
async def heartbeat_task():
    print("å¿ƒè·³æ£€æµ‹...")
    # æ‰§è¡Œå¥åº·æ£€æŸ¥é€»è¾‘

@time_on("cleanup", interval=3600, priority=2).execute()
async def cleanup_task(cache_service: ICacheService):
    print("æ¸…ç†è¿‡æœŸç¼“å­˜...")
    await cache_service.cleanup()
```

#### æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… (@re_on)

```python
import re
from decorators import re_on

@re_on("message", r"^\d+$", re.IGNORECASE).execute()
async def handle_number_message(content: str):
    number = int(content)
    return f"ä½ è¾“å…¥äº†æ•°å­—: {number}"

@re_on("message", r"^[A-Za-z]+$").execute()
async def handle_text_message(content: str):
    return f"ä½ è¾“å…¥äº†æ–‡æœ¬: {content}"
```

### 9. ä¼˜å…ˆçº§é˜Ÿåˆ—ç³»ç»Ÿ

æ¡†æ¶å†…ç½®é«˜æ€§èƒ½ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ”¯æŒèµ„æºæ§åˆ¶å’Œå¹¶å‘ç®¡ç†ã€‚

#### åŸºæœ¬ä½¿ç”¨

```python
from nucleus import PriorityQueue, ResourceController

# åˆ›å»ºä¼˜å…ˆçº§é˜Ÿåˆ—
queue = PriorityQueue(maxsize=100)

# æ·»åŠ ä»»åŠ¡ï¼ˆä¼˜å…ˆçº§è¶Šé«˜è¶Šå…ˆæ‰§è¡Œï¼‰
await queue.put("ä½ä¼˜å…ˆçº§ä»»åŠ¡", priority=1)
await queue.put("é«˜ä¼˜å…ˆçº§ä»»åŠ¡", priority=10)
await queue.put("ä¸­ç­‰ä¼˜å…ˆçº§ä»»åŠ¡", priority=5)

# è·å–ä»»åŠ¡ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
task1 = await queue.get()  # é«˜ä¼˜å…ˆçº§ä»»åŠ¡
task2 = await queue.get()  # ä¸­ç­‰ä¼˜å…ˆçº§ä»»åŠ¡
task3 = await queue.get()  # ä½ä¼˜å…ˆçº§ä»»åŠ¡
```

#### èµ„æºæ§åˆ¶

```python
# åˆ›å»ºå¸¦èµ„æºæ§åˆ¶çš„é˜Ÿåˆ—
resource_controller = ResourceController(
    max_memory_mb=100,      # æœ€å¤§å†…å­˜ä½¿ç”¨
    max_concurrent=10,      # æœ€å¤§å¹¶å‘æ•°
    cleanup_threshold=0.8   # æ¸…ç†é˜ˆå€¼
)

queue = PriorityQueue(
    maxsize=1000,
    resource_controller=resource_controller
)

# é˜Ÿåˆ—ä¼šè‡ªåŠ¨ç®¡ç†èµ„æºä½¿ç”¨
await queue.put("å¤§æ•°æ®å¤„ç†ä»»åŠ¡", priority=8, size_estimate=50)  # é¢„ä¼°50MB
```

## 10. æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
nucleus/
â”œâ”€â”€ __init__.py              # ä¸»è¦å¯¼å‡º
â”œâ”€â”€ core/                    # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ integration.py      # æ¡†æ¶é›†æˆ
â”‚   â”œâ”€â”€ di.py               # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ chain.py            # è°ƒç”¨é“¾
â”‚   â””â”€â”€ task_manager.py     # ä»»åŠ¡ç®¡ç†
â”œâ”€â”€ data/                    # æ•°æ®ç»“æ„
â”‚   â”œâ”€â”€ priority_queue.py   # ä¼˜å…ˆçº§é˜Ÿåˆ—
â”‚   â””â”€â”€ tree.py             # æ ‘ç»“æ„
â”œâ”€â”€ dispatcher.py           # è°ƒåº¦å™¨
â””â”€â”€ Myclass.py             # ç±»æ ¸å¿ƒ

decorators/
â”œâ”€â”€ __init__.py            # è£…é¥°å™¨å¯¼å‡º
â””â”€â”€ on.py                  # æ‰€æœ‰è£…é¥°å™¨å®ç°
```

### è®¾è®¡åŸåˆ™

1. **é›¶ä¾èµ–**: ä»…ä½¿ç”¨Pythonæ ‡å‡†åº“
2. **å¼‚æ­¥ä¼˜å…ˆ**: å®Œå…¨æ”¯æŒå¼‚æ­¥ç¼–ç¨‹
3. **ç±»å‹å®‰å…¨**: æ”¯æŒç±»å‹æ³¨è§£å’Œæ£€æŸ¥
4. **æ¨¡å—åŒ–**: ç»„ä»¶å¯ç‹¬ç«‹ä½¿ç”¨
5. **å¯æ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰æ‹¦æˆªå™¨å’ŒæœåŠ¡

## 11. æœ€ä½³å®è·µ

### 1. æœåŠ¡è®¾è®¡

```python
# âœ… å¥½çš„å®è·µ - åŸºäºæ¥å£çš„è®¾è®¡
class IRepository:
    async def get_by_id(self, id: str): pass

@service(IRepository)
class UserRepository(IRepository):
    async def get_by_id(self, id: str):
        # å®ç°è·å–ç”¨æˆ·é€»è¾‘
        pass

# âœ… å¥½çš„å®è·µ - æ„é€ å‡½æ•°æ³¨å…¥
@service('singleton')
class UserService:
    def __init__(self, repository: IRepository):
        self.repository = repository
```

### 2. é”™è¯¯å¤„ç†

```python
# âœ… å¥½çš„å®è·µ - åœ¨äº‹ä»¶å¤„ç†ä¸­æ·»åŠ é”™è¯¯å¤„ç†
@on("data_processing").execute()
async def handle_data_processing(data_service: IDataService, raw_data: str):
    try:
        result = await data_service.process(raw_data)
        return {"status": "success", "data": result}
    except Exception as e:
        print(f"æ•°æ®å¤„ç†å¤±è´¥: {e}")
        return {"status": "error", "message": str(e)}
```

### 3. æ€§èƒ½ä¼˜åŒ–

```python
# âœ… å¥½çš„å®è·µ - ä½¿ç”¨å•ä¾‹æœåŠ¡å‡å°‘å¯¹è±¡åˆ›å»º
@service('singleton')
class CacheService:
    def __init__(self):
        self.cache = {}
    
    async def get(self, key: str):
        return self.cache.get(key)
    
    async def set(self, key: str, value: Any):
        self.cache[key] = value

# âœ… å¥½çš„å®è·µ - åˆç†ä½¿ç”¨ä»»åŠ¡ç®¡ç†
async def batch_process(items: List[str]):
    task_manager = get_task_manager()
    tasks = []
    
    for item in items:
        task_id = task_manager.create_task(
            process_item(item),
            name=f"å¤„ç†_{item}"
        )
        tasks.append(task_id)
    
    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    results = await asyncio.gather(*[
        task_manager.wait_for_task_async(task_id)
        for task_id in tasks
    ])
    
    return results
```

## 12. é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰å‚æ•°è§£æå™¨

ä¸ºå‘½ä»¤å¤„ç†æ·»åŠ è‡ªå®šä¹‰å‚æ•°è§£æé€»è¾‘ï¼š

```python
from decorators import command_on

def custom_arg_parser(args_str: str) -> dict:
    """è‡ªå®šä¹‰å‚æ•°è§£æå™¨ - å°†å‚æ•°å­—ç¬¦ä¸²è§£æä¸ºå­—å…¸"""
    if not args_str.strip():
        return {"action": "help"}
    
    # è§£æ key=value æ ¼å¼çš„å‚æ•°
    args_dict = {}
    for pair in args_str.split():
        if "=" in pair:
            key, value = pair.split("=", 1)
            args_dict[key] = value
    
    return args_dict if args_dict else {"action": "default"}

@command_on("advanced", "/advanced", arg_parser=custom_arg_parser).execute()
async def handle_advanced_command(user_service: UserService, parsed_args: dict):
    """å¤„ç†å¸¦è‡ªå®šä¹‰å‚æ•°è§£æçš„é«˜çº§å‘½ä»¤"""
    action = parsed_args.get("action", "default")
    
    if action == "help":
        return "å¯ç”¨å‚æ•°: action=help|create|delete name=<ç”¨æˆ·å>"
    elif action == "create":
        name = parsed_args.get("name", "æ–°ç”¨æˆ·")
        return f"åˆ›å»ºç”¨æˆ·: {name}"
    elif action == "delete":
        name = parsed_args.get("name")
        if name:
            return f"åˆ é™¤ç”¨æˆ·: {name}"
        return "é”™è¯¯: åˆ é™¤æ“ä½œéœ€è¦æŒ‡å®š name å‚æ•°"
    else:
        return f"æ‰§è¡Œé»˜è®¤æ“ä½œ: {action}"

# ä½¿ç”¨ç¤ºä¾‹
# /advanced action=create name=å¼ ä¸‰  -> åˆ›å»ºç”¨æˆ·: å¼ ä¸‰
# /advanced action=help               -> æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
# /advanced                           -> æ‰§è¡Œé»˜è®¤æ“ä½œ: default
```

#### æ™ºèƒ½å‚æ•°è§£æå™¨å®ç°

æ¡†æ¶æ”¯æŒå¤šç§å‚æ•°æ ¼å¼çš„æ™ºèƒ½è§£æï¼š

```python
def smart_arg_parser(args_str: str) -> dict:
    """æ™ºèƒ½å‚æ•°è§£æå™¨ - æ”¯æŒå¤šç§å‚æ•°æ ¼å¼"""
    result = {}
    
    # 1. JSONæ ¼å¼è§£æ
    if args_str.strip().startswith('{'):
        try:
            import json
            return json.loads(args_str)
        except json.JSONDecodeError:
            pass
    
    # 2. key=value æ ¼å¼è§£æ
    if '=' in args_str:
        pairs = args_str.split()
        for pair in pairs:
            if '=' in pair:
                key, value = pair.split('=', 1)
                # è‡ªåŠ¨ç±»å‹æ¨æ–­
                if value.lower() in ('true', 'false'):
                    result[key] = value.lower() == 'true'
                elif value.isdigit():
                    result[key] = int(value)
                elif value.replace('.', '').isdigit():
                    result[key] = float(value)
                elif value.startswith('"') and value.endswith('"'):
                    result[key] = value[1:-1]  # ç§»é™¤å¼•å·
                else:
                    result[key] = value
        return result
    
    # 3. ä½ç½®å‚æ•°è§£æ
    parts = args_str.strip().split()
    if parts:
        result['args'] = parts
    
    return result

@command_on("smart", "/smart", arg_parser=smart_arg_parser).execute()
async def handle_smart_command(user_service: UserService, **kwargs):
    """å¤„ç†æ™ºèƒ½å‚æ•°è§£æå‘½ä»¤"""
    # kwargsåŒ…å«äº†è§£æåçš„å‚æ•°
    if 'user_id' in kwargs:
        user = await user_service.get_user(kwargs['user_id'])
        return f"ç”¨æˆ·: {user['name']}"
    elif 'args' in kwargs:
        return f"æ”¶åˆ°å‚æ•°: {kwargs['args']}"
    else:
        return f"æ”¶åˆ°å‚æ•°: {kwargs}"

# ä½¿ç”¨ç¤ºä¾‹
# /smart {"user_id": "123", "action": "get"}     -> JSONæ ¼å¼
# /smart user_id=123 action=get                   -> key=valueæ ¼å¼
# /smart 123 get                                  -> ä½ç½®å‚æ•°æ ¼å¼
# /smart user_id=123 active=true count=5        -> è‡ªåŠ¨ç±»å‹æ¨æ–­
```

### 2. å¤šäº‹ä»¶ç›‘å¬å™¨æ¨¡å¼

å®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œä¸€ä¸ªäº‹ä»¶è§¦å‘å¤šä¸ªå¤„ç†å™¨ï¼š

```python
from decorators import on

# ç”¨æˆ·ç™»å½•äº‹ä»¶çš„ä¸åŒå¤„ç†å™¨
@on("user_login").execute()
async def log_user_login(user_id: str, ip: str):
    """è®°å½•ç”¨æˆ·ç™»å½•æ—¥å¿—"""
    print(f"[æ—¥å¿—] ç”¨æˆ· {user_id} ä» {ip} ç™»å½•")

@on("user_login").execute()
async def update_user_status(user_id: str, user_service: UserService):
    """æ›´æ–°ç”¨æˆ·åœ¨çº¿çŠ¶æ€"""
    await user_service.update_status(user_id, "online")
    print(f"[çŠ¶æ€] ç”¨æˆ· {user_id} çŠ¶æ€æ›´æ–°ä¸ºåœ¨çº¿")

@on("user_login").execute()
async def send_welcome_notification(user_id: str, notification_service: NotificationService):
    """å‘é€æ¬¢è¿é€šçŸ¥"""
    await notification_service.send(user_id, "æ¬¢è¿å›æ¥ï¼")
    print(f"[é€šçŸ¥] å‘ç”¨æˆ· {user_id} å‘é€æ¬¢è¿æ¶ˆæ¯")

# è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œä¸‰ä¸ªå¤„ç†å™¨éƒ½ä¼šæ‰§è¡Œ
await dispatcher.trigger_event("user_login", user_id="123", ip="192.168.1.1")
```

### 3. æ¡ä»¶äº‹ä»¶å¤„ç†

ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è£…é¥°å™¨å®ç°æ™ºèƒ½äº‹ä»¶åŒ¹é…ï¼š

```python
import re
from decorators import re_on

# æ™ºèƒ½æ¶ˆæ¯å¤„ç†ç³»ç»Ÿ
@re_on("message", r"^è®¢å•_(\d+)$", re.IGNORECASE).execute()
async def handle_order_message(order_id: str, order_service: OrderService):
    """å¤„ç†è®¢å•ç›¸å…³æ¶ˆæ¯"""
    order_info = await order_service.get_order(order_id)
    return f"è®¢å• {order_id} çŠ¶æ€: {order_info['status']}"

@re_on("message", r"^æŠ•è¯‰_(.+)$").execute()
async def handle_complaint_message(content: str, complaint_service: ComplaintService):
    """å¤„ç†æŠ•è¯‰æ¶ˆæ¯"""
    complaint_text = content.split("_", 1)[1]
    complaint_id = await complaint_service.create_complaint(complaint_text)
    return f"æŠ•è¯‰å·²åˆ›å»ºï¼Œç¼–å·: {complaint_id}"

@re_on("message", r"^\d+$").execute()
async def handle_number_message(number_str: str):
    """å¤„ç†çº¯æ•°å­—æ¶ˆæ¯"""
    number = int(number_str)
    return f"æ”¶åˆ°æ•°å­—: {number}ï¼Œå¹³æ–¹æ˜¯: {number**2}"

# ä½¿ç”¨ç¤ºä¾‹
# dispatcher.trigger_event("message", content="è®¢å•_12345")  -> è¿”å›è®¢å•çŠ¶æ€
# dispatcher.trigger_event("message", content="æŠ•è¯‰_æœåŠ¡ä¸å¥½") -> åˆ›å»ºæŠ•è¯‰
# dispatcher.trigger_event("message", content="42")         -> è¿”å›æ•°å­—ä¿¡æ¯
```

### 4. åŠ¨æ€æœåŠ¡æ³¨å†Œ

åœ¨è¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œå’Œç®¡ç†æœåŠ¡ï¼š

```python
from nucleus.core.integration import get_framework_integration

async def register_dynamic_services():
    """åŠ¨æ€æ³¨å†ŒæœåŠ¡"""
    integration = get_framework_integration()
    container = integration.get_dependency_container()
    
    # æ ¹æ®é…ç½®åŠ¨æ€é€‰æ‹©å®ç°
    config = {"db_type": "mysql", "cache_type": "redis"}
    
    if config["db_type"] == "mysql":
        @service(IDatabaseService)
        class MySQLService(IDatabaseService):
            async def query(self, sql: str):
                return f"MySQLæ‰§è¡Œ: {sql}"
    else:
        @service(IDatabaseService)
        class PostgreSQLService(IDatabaseService):
            async def query(self, sql: str):
                return f"PostgreSQLæ‰§è¡Œ: {sql}"
    
    # æ³¨å†Œç¼“å­˜æœåŠ¡
    if config["cache_type"] == "redis":
        @service(ICacheService)
        class RedisCacheService(ICacheService):
            def __init__(self):
                self.cache = {}
            async def get(self, key: str):
                return self.cache.get(key)
            async def set(self, key: str, value: str):
                self.cache[key] = value
    
    print("åŠ¨æ€æœåŠ¡æ³¨å†Œå®Œæˆ")

# åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
await register_dynamic_services()
```

### 5. ä»»åŠ¡æµæ°´çº¿

ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨åˆ›å»ºå¤æ‚çš„å¤„ç†æµæ°´çº¿ï¼š

```python
from nucleus.core.integration import get_task_manager

async def create_processing_pipeline(data: dict):
    """åˆ›å»ºæ•°æ®å¤„ç†æµæ°´çº¿"""
    task_manager = get_task_manager()
    
    # æ­¥éª¤1: æ•°æ®éªŒè¯
    validation_task = task_manager.create_task(
        validate_data(data),
        name="æ•°æ®éªŒè¯",
        priority=10
    )
    
    # ç­‰å¾…éªŒè¯å®Œæˆ
    validation_result = await task_manager.wait_for_task_async(validation_task)
    
    if not validation_result["valid"]:
        return {"error": "æ•°æ®éªŒè¯å¤±è´¥", "details": validation_result["errors"]}
    
    # æ­¥éª¤2: æ•°æ®æ¸…æ´—
    cleaning_task = task_manager.create_task(
        clean_data(validation_result["data"]),
        name="æ•°æ®æ¸…æ´—",
        priority=8
    )
    
    # æ­¥éª¤3: æ•°æ®è½¬æ¢ï¼ˆä¸æ¸…æ´—å¹¶è¡Œï¼‰
    transformation_task = task_manager.create_task(
        transform_data(validation_result["data"]),
        name="æ•°æ®è½¬æ¢",
        priority=7
    )
    
    # æ­¥éª¤4: æ•°æ®å­˜å‚¨ï¼ˆä¾èµ–å‰ä¸¤æ­¥å®Œæˆï¼‰
    cleaned_data = await task_manager.wait_for_task_async(cleaning_task)
    transformed_data = await task_manager.wait_for_task_async(transformation_task)
    
    storage_task = task_manager.create_task(
        store_data(cleaned_data, transformed_data),
        name="æ•°æ®å­˜å‚¨",
        priority=5
    )
    
    # ç­‰å¾…æœ€ç»ˆç»“æœ
    final_result = await task_manager.wait_for_task_async(storage_task)
    
    return {
        "status": "success",
        "result": final_result,
        "pipeline_stats": task_manager.get_statistics()
    }

# ä½¿ç”¨æµæ°´çº¿
result = await create_processing_pipeline({"raw_data": "åŸå§‹æ•°æ®"})
```

### 6. äº‹ä»¶é©±åŠ¨æ¶æ„

æ„å»ºå®Œæ•´çš„äº‹ä»¶é©±åŠ¨å¾®æœåŠ¡æ¶æ„ï¼š

```python
# é¢†åŸŸäº‹ä»¶å®šä¹‰
class DomainEvents:
    USER_REGISTERED = "user.registered"
    ORDER_CREATED = "order.created"
    PAYMENT_COMPLETED = "payment.completed"
    INVENTORY_UPDATED = "inventory.updated"

# äº‹ä»¶å¤„ç†å™¨ - ç”¨æˆ·æœåŠ¡
@on(DomainEvents.USER_REGISTERED).execute()
async def handle_user_registered(user_id: str, email: str, user_service: UserService):
    """å¤„ç†ç”¨æˆ·æ³¨å†Œäº‹ä»¶"""
    # åˆ›å»ºç”¨æˆ·æ¡£æ¡ˆ
    await user_service.create_profile(user_id, email)
    
    # è§¦å‘åç»­äº‹ä»¶
    await dispatcher.trigger_event("notification.send_welcome", user_id=user_id, email=email)

# äº‹ä»¶å¤„ç†å™¨ - è®¢å•æœåŠ¡
@on(DomainEvents.ORDER_CREATED).execute()
async def handle_order_created(order_id: str, user_id: str, amount: float, order_service: OrderService):
    """å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶"""
    # éªŒè¯åº“å­˜
    inventory_result = await order_service.check_inventory(order_id)
    
    if inventory_result["available"]:
        # è§¦å‘æ”¯ä»˜æµç¨‹
        await dispatcher.trigger_event(DomainEvents.PAYMENT_COMPLETED, order_id=order_id, amount=amount)
    else:
        # åº“å­˜ä¸è¶³ï¼Œå–æ¶ˆè®¢å•
        await order_service.cancel_order(order_id, "åº“å­˜ä¸è¶³")

# äº‹ä»¶å¤„ç†å™¨ - æ”¯ä»˜æœåŠ¡
@on(DomainEvents.PAYMENT_COMPLETED).execute()
async def handle_payment_completed(order_id: str, payment_service: PaymentService):
    """å¤„ç†æ”¯ä»˜å®Œæˆäº‹ä»¶"""
    # æ›´æ–°è®¢å•çŠ¶æ€
    await payment_service.confirm_payment(order_id)
    
    # è§¦å‘åº“å­˜æ›´æ–°
    await dispatcher.trigger_event(DomainEvents.INVENTORY_UPDATED, order_id=order_id)
    
    # å‘é€ç¡®è®¤é‚®ä»¶
    await dispatcher.trigger_event("notification.send_confirmation", order_id=order_id)

# äº‹ä»¶å¤„ç†å™¨ - åº“å­˜æœåŠ¡
@on(DomainEvents.INVENTORY_UPDATED).execute()
async def handle_inventory_updated(order_id: str, inventory_service: InventoryService):
    """å¤„ç†åº“å­˜æ›´æ–°äº‹ä»¶"""
    await inventory_service.deduct_inventory(order_id)
    
    # è§¦å‘ç‰©æµæµç¨‹
    await dispatcher.trigger_event("shipping.process_order", order_id=order_id)

# ä½¿ç”¨ç¤ºä¾‹ - å®Œæ•´çš„ç”µå•†æµç¨‹
await dispatcher.trigger_event(DomainEvents.USER_REGISTERED, user_id="user123", email="user@example.com")
await dispatcher.trigger_event(DomainEvents.ORDER_CREATED, order_id="order456", user_id="user123", amount=99.99)
# ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ•´ä¸ªæµç¨‹é“¾
```

## 13. æ¡†æ¶æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

æ¡†æ¶æä¾›ä¼ä¸šçº§çš„æ ¸å¿ƒåŠŸèƒ½ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä¾èµ–æ³¨å…¥ã€è°ƒç”¨é“¾æ‹¦æˆªã€ä»»åŠ¡ç®¡ç†å’Œé«˜çº§å‚æ•°è§£æç­‰å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚

### å‚æ•°è§£æç³»ç»Ÿ

æ¡†æ¶æä¾›å¼ºå¤§çš„å‚æ•°è§£æåŠŸèƒ½ï¼Œæ”¯æŒå¤šç§å‚æ•°æ ¼å¼å’Œè‡ªå®šä¹‰è§£æå™¨ã€‚

#### åŸºç¡€å‚æ•°è§£æ

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¡†æ¶ä¼šå°†å‘½ä»¤å‚æ•°æŒ‰ç©ºæ ¼åˆ†å‰²æˆåˆ—è¡¨ï¼š

```python
@command_on("basic", "/hello").execute()
async def handle_hello_command(args: list = None):
    """åŸºç¡€å‚æ•°å¤„ç† - argsæ˜¯listç±»å‹"""
    if args is None:
        args = []
    return f"æ”¶åˆ° {len(args)} ä¸ªå‚æ•°: {args}"

# ä½¿ç”¨ç¤ºä¾‹
# /hello world python           -> æ”¶åˆ° 2 ä¸ªå‚æ•°: ['world', 'python']
# /hello                        -> æ”¶åˆ° 0 ä¸ªå‚æ•°: []
```

#### é«˜çº§å‚æ•°è§£æ

é€šè¿‡`arg_parser`å‚æ•°ï¼Œå¯ä»¥å®ç°å¤æ‚çš„å‚æ•°è§£æé€»è¾‘ï¼š

```python
def json_arg_parser(args_str: str) -> dict:
    """JSONæ ¼å¼å‚æ•°è§£æå™¨"""
    if not args_str.strip():
        return {}
    
    try:
        import json
        return json.loads(args_str)
    except json.JSONDecodeError:
        return {"error": "æ— æ•ˆçš„JSONæ ¼å¼"}

@command_on("api", "/api", arg_parser=json_arg_parser).execute()
async def handle_api_command(**kwargs):
    """å¤„ç†JSONæ ¼å¼å‚æ•°"""
    if "error" in kwargs:
        return f"é”™è¯¯: {kwargs['error']}"
    
    # kwargsåŒ…å«äº†è§£æåçš„JSONæ•°æ®
    action = kwargs.get("action", "unknown")
    data = kwargs.get("data", {})
    return f"æ‰§è¡Œæ“ä½œ: {action}, æ•°æ®: {data}"

# ä½¿ç”¨ç¤ºä¾‹
# /api {"action": "create", "data": {"name": "å¼ ä¸‰"}}
# è¿”å›: æ‰§è¡Œæ“ä½œ: create, æ•°æ®: {'name': 'å¼ ä¸‰'}
```

#### æ™ºèƒ½å‚æ•°è§£æå™¨

æ¡†æ¶æ”¯æŒè‡ªåŠ¨ç±»å‹æ¨æ–­å’Œå¤šç§å‚æ•°æ ¼å¼ï¼š

```python
def smart_arg_parser(args_str: str) -> dict:
    """æ™ºèƒ½å‚æ•°è§£æå™¨ - æ”¯æŒå¤šç§å‚æ•°æ ¼å¼"""
    result = {}
    
    # 1. JSONæ ¼å¼è§£æ
    if args_str.strip().startswith('{'):
        try:
            import json
            return json.loads(args_str)
        except json.JSONDecodeError:
            pass
    
    # 2. key=value æ ¼å¼è§£æ
    if '=' in args_str:
        pairs = args_str.split()
        for pair in pairs:
            if '=' in pair:
                key, value = pair.split('=', 1)
                # è‡ªåŠ¨ç±»å‹æ¨æ–­
                if value.lower() in ('true', 'false'):
                    result[key] = value.lower() == 'true'
                elif value.isdigit():
                    result[key] = int(value)
                elif value.replace('.', '').isdigit():
                    result[key] = float(value)
                elif value.startswith('"') and value.endswith('"'):
                    result[key] = value[1:-1]  # ç§»é™¤å¼•å·
                else:
                    result[key] = value
        return result
    
    # 3. ä½ç½®å‚æ•°è§£æ
    parts = args_str.strip().split()
    if parts:
        result['args'] = parts
    
    return result

@command_on("smart", "/smart", arg_parser=smart_arg_parser).execute()
async def handle_smart_command(user_service: UserService, **kwargs):
    """å¤„ç†æ™ºèƒ½å‚æ•°è§£æå‘½ä»¤"""
    # kwargsåŒ…å«äº†è§£æåçš„å‚æ•°
    if 'user_id' in kwargs:
        user = await user_service.get_user(kwargs['user_id'])
        return f"ç”¨æˆ·: {user['name']}"
    elif 'args' in kwargs:
        return f"æ”¶åˆ°å‚æ•°: {kwargs['args']}"
    else:
        return f"æ”¶åˆ°å‚æ•°: {kwargs}"

# ä½¿ç”¨ç¤ºä¾‹
# /smart {"user_id": "123", "action": "get"}     -> JSONæ ¼å¼
# /smart user_id=123 action=get                   -> key=valueæ ¼å¼
# /smart 123 get                                  -> ä½ç½®å‚æ•°æ ¼å¼
# /smart user_id=123 active=true count=5        -> è‡ªåŠ¨ç±»å‹æ¨æ–­
```

#### å‚æ•°è§£æå™¨ç‰¹æ€§

1. **ç±»å‹è‡ªåŠ¨æ¨æ–­**: è‡ªåŠ¨è¯†åˆ«å¸ƒå°”å€¼ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸¦å¼•å·å­—ç¬¦ä¸²
2. **å¤šæ ¼å¼æ”¯æŒ**: æ”¯æŒJSONã€key=valueã€ä½ç½®å‚æ•°ç­‰å¤šç§æ ¼å¼
3. **é”™è¯¯å¤„ç†**: æä¾›å‹å¥½çš„é”™è¯¯æç¤ºå’Œå›é€€æœºåˆ¶
4. **çµæ´»æ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰è§£æé€»è¾‘ï¼Œæ»¡è¶³ç‰¹å®šä¸šåŠ¡éœ€æ±‚
5. **ä¾èµ–æ³¨å…¥å…¼å®¹**: è§£æç»“æœå¯ä»¥ç›´æ¥ç”¨äºä¾èµ–æ³¨å…¥

## 14. å‚æ•°å‚è€ƒ

### @service è£…é¥°å™¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| lifetime_or_interface | str/Type | 'singleton' | ç”Ÿå‘½å‘¨æœŸ('singleton'/'transient'/'scoped')æˆ–æ¥å£ç±»å‹ |

### @on è£…é¥°å™¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| name | str | å¿…å¡« | äº‹ä»¶åç§° |

### @command_on è£…é¥°å™¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| name | str | å¿…å¡« | å¤„ç†å™¨åç§° |
| command | str | å¿…å¡« | å‘½ä»¤å­—ç¬¦ä¸²ï¼ˆå¿…é¡»ä»¥/å¼€å¤´ï¼‰ |
| aliases | List[str] | None | å‘½ä»¤åˆ«ååˆ—è¡¨ |
| cooldown | int | 0 | å†·å´æ—¶é—´ï¼ˆç§’ï¼‰ |
| arg_parser | Callable[[str], Dict[str, Any]] | None | è‡ªå®šä¹‰å‚æ•°è§£æå‡½æ•°ï¼Œå°†å‚æ•°å­—ç¬¦ä¸²è§£æä¸ºå­—å…¸ |

**é‡è¦æç¤º**: 
1. å‘½ä»¤å¤„ç†å‡½æ•°çš„`args`å‚æ•°å¿…é¡»æ˜¯`list`ç±»å‹ï¼Œä¸æ˜¯`str`ç±»å‹ã€‚æ¡†æ¶ä¼šè‡ªåŠ¨å°†å‘½ä»¤å‚æ•°åˆ†å‰²æˆåˆ—è¡¨ä¼ å…¥ã€‚
2. `arg_parser`å‚æ•°æ”¯æŒè‡ªå®šä¹‰å‚æ•°è§£æé€»è¾‘ï¼Œå¯ä»¥è§£æå¤æ‚æ ¼å¼çš„å‚æ•°ï¼Œå¦‚`key=value`æ ¼å¼ã€JSONæ ¼å¼ç­‰ã€‚
3. å¦‚æœæä¾›äº†`arg_parser`ï¼Œæ¡†æ¶ä¼šä½¿ç”¨è‡ªå®šä¹‰è§£æå™¨å¤„ç†å‚æ•°ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤çš„ç©ºæ ¼åˆ†å‰²æ–¹å¼ã€‚

### @time_on è£…é¥°å™¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| name | str | å¿…å¡« | ä»»åŠ¡åç§° |
| interval | int | 0 | æ‰§è¡Œé—´éš”ï¼ˆç§’ï¼‰ |
| priority | int | 1 | ä»»åŠ¡ä¼˜å…ˆçº§ |

### @re_on è£…é¥°å™¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| name | str | å¿…å¡« | å¤„ç†å™¨åç§° |
| content | str | å¿…å¡« | åŒ¹é…å†…å®¹ |
| pattern | object | å¿…å¡« | æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ |
| priority | int | 1 | å¤„ç†å™¨ä¼˜å…ˆçº§ |

## 15. æµ‹è¯•éªŒè¯

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python -m pytest tests/ -v

# é¢„æœŸè¾“å‡º:
# =========== test session starts ===========
# collected 44 items
# tests/test_basic.py ..............    [32%]
# tests/test_core_integration.py ..............    [64%]
# tests/test_priority_queue.py ..............    [100%]
# =========== 44 passed in 1.50s ===========
```

### è¿è¡Œç‰¹å®šç¤ºä¾‹

```bash
# å¿«é€Ÿå¼€å§‹ç¤ºä¾‹
python examples/quick_start_example.py

# ä¾èµ–æ³¨å…¥ç¤ºä¾‹
python examples/on_di_example.py

# å‘½ä»¤è°ƒåº¦ç¤ºä¾‹
python examples/command_on_di_example.py

# ä¼˜å…ˆçº§é˜Ÿåˆ—ç¤ºä¾‹
python examples/priority_queue_example.py

# å®Œæ•´æ¼”ç¤º
python complete_demo.py
```

### æ€§èƒ½æµ‹è¯•

```bash
# ä¼˜å…ˆçº§é˜Ÿåˆ—æ€§èƒ½æµ‹è¯•
python examples/priority_queue_example.py
# é¢„æœŸæ€§èƒ½: >100,000 ä»»åŠ¡/ç§’

# å®Œæ•´æ¡†æ¶æ€§èƒ½æµ‹è¯•
python complete_demo.py
# åŒ…å«äº‹ä»¶å¤„ç†ã€ä»»åŠ¡è°ƒåº¦ã€ä¾èµ–æ³¨å…¥ç­‰ç»¼åˆæµ‹è¯•
```

## 16. æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ModuleNotFoundError: No module named 'nucleus'

**é—®é¢˜**: å¯¼å…¥æ¨¡å—å¤±è´¥
**è§£å†³**: ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼Œæˆ–æ·»åŠ è·¯å¾„ï¼š
```python
import sys
sys.path.insert(0, '.')  # æ·»åŠ å½“å‰ç›®å½•åˆ°Pythonè·¯å¾„
```

#### 2. è£…é¥°å™¨ä¸ç”Ÿæ•ˆ

**é—®é¢˜**: ä½¿ç”¨äº†`@on("event")`ä½†æ²¡æœ‰`.execute()`
**è§£å†³**: æ‰€æœ‰äº‹ä»¶è£…é¥°å™¨éƒ½å¿…é¡»ä½¿ç”¨`.execute()`ï¼š
```python
# âŒ é”™è¯¯
@on("event")
def handler(): pass

# âœ… æ­£ç¡®
@on("event").execute()
def handler(): pass
```

#### 3. ä¾èµ–æ³¨å…¥å¤±è´¥

**é—®é¢˜**: æœåŠ¡æ— æ³•è§£æ
**è§£å†³**: ç¡®ä¿ï¼š
1. å…ˆè°ƒç”¨`enable_framework_integration()`
2. æœåŠ¡å·²ç”¨`@service`è£…é¥°å™¨æ³¨å†Œ
3. æ¥å£å’Œå®ç°ç±»å…³ç³»æ­£ç¡®

```python
# âœ… æ­£ç¡®é¡ºåº
enable_framework_integration()  # å…ˆå¯ç”¨é›†æˆ

@service(IMyService)  # å†æ³¨å†ŒæœåŠ¡
class MyService(IMyService):
    pass
```

### 4. å‘½ä»¤å‚æ•°ç±»å‹é”™è¯¯

**é—®é¢˜**: å‘½ä»¤å¤„ç†å‡½æ•°å‚æ•°ç±»å‹ä¸åŒ¹é…ï¼Œå¯¼è‡´`TypeError`
**è§£å†³**: `@command_on`è£…é¥°å™¨çš„å‘½ä»¤å¤„ç†å‡½æ•°å¿…é¡»ä½¿ç”¨`list`ç±»å‹æ¥æ”¶å‚æ•°ï¼š

```python
# âŒ é”™è¯¯ - ä½¿ç”¨strç±»å‹å‚æ•°
@command_on("greet", "/greet").execute()
async def handle_greet_command(user_service: UserService, args: str = ""):
    user_id = args  # è¿™é‡Œä¼šå‡ºé”™ï¼Œå› ä¸ºargså®é™…æ˜¯list
    
# âœ… æ­£ç¡® - ä½¿ç”¨listç±»å‹å‚æ•°
@command_on("greet", "/greet").execute()
async def handle_greet_command(user_service: UserService, args: list = None):
    if args is None:
        args = []
    user_id = args[0] if args else "1"  # æ­£ç¡®å¤„ç†listå‚æ•°
```

### 5. è‡ªå®šä¹‰å‚æ•°è§£æå™¨é”™è¯¯

**é—®é¢˜**: ä½¿ç”¨`arg_parser`å‚æ•°æ—¶ï¼Œè§£æå™¨å‡½æ•°è¿”å›ç±»å‹ä¸æ­£ç¡®
**è§£å†³**: ç¡®ä¿è‡ªå®šä¹‰å‚æ•°è§£æå™¨è¿”å›`dict`ç±»å‹ï¼š

```python
# âŒ é”™è¯¯ - è§£æå™¨è¿”å›édictç±»å‹
def bad_parser(args_str: str):
    return args_str.split()  # è¿”å›listï¼Œä¼šå¯¼è‡´é”™è¯¯

# âœ… æ­£ç¡® - è§£æå™¨è¿”å›dictç±»å‹
def good_parser(args_str: str) -> dict:
    return {"args": args_str.split()}  # è¿”å›dict

@command_on("test", "/test", arg_parser=good_parser).execute()
async def handle_test_command(parsed_args: dict):
    # parsed_argsæ˜¯dictç±»å‹ï¼ŒåŒ…å«è§£æåçš„å‚æ•°
    return f"æ”¶åˆ°å‚æ•°: {parsed_args}"
```

### 6. äº‹ä»¶ä¸è§¦å‘

**é—®é¢˜**: äº‹ä»¶è§¦å‘ä½†æ²¡æœ‰å“åº”
**è§£å†³**: æ£€æŸ¥äº‹ä»¶åç§°æ˜¯å¦åŒ¹é…ï¼š
```python
@on("user_login").execute()  # æ³¨å†Œäº‹ä»¶
async def handle_login():
    pass

# è§¦å‘æ—¶ä½¿ç”¨ç›¸åŒåç§°
await dispatcher.trigger_event("user_login")  # âœ… åŒ¹é…
await dispatcher.trigger_event("login")       # âŒ ä¸åŒ¹é…
```

### 7. å‚æ•°è§£æå™¨ç±»å‹é”™è¯¯

**é—®é¢˜**: è‡ªå®šä¹‰å‚æ•°è§£æå™¨å‡½æ•°ç­¾åä¸æ­£ç¡®
**è§£å†³**: ç¡®ä¿å‚æ•°è§£æå™¨ç¬¦åˆ`Callable[[str], Dict[str, Any]]`ç±»å‹ï¼š

```python
# âŒ é”™è¯¯ - å‡½æ•°ç­¾åä¸æ­£ç¡®
def bad_parser(arg1: str, arg2: str) -> dict:  # å‚æ•°å¤ªå¤š
    return {}

# âœ… æ­£ç¡® - å‡½æ•°ç­¾åæ­£ç¡®
def good_parser(args_str: str) -> dict:
    """æ­£ç¡®çš„å‚æ•°è§£æå™¨ç­¾å"""
    return {"parsed": args_str}

@command_on("correct", "/correct", arg_parser=good_parser).execute()
async def handle_correct_command(parsed: dict):
    return f"è§£æç»“æœ: {parsed}"
```

### è°ƒè¯•æŠ€å·§

#### 1. æ£€æŸ¥æœåŠ¡æ³¨å†ŒçŠ¶æ€

```python
from nucleus.core.integration import get_framework_integration

integration = get_framework_integration()
container = integration.get_dependency_container()

# æŸ¥çœ‹å·²æ³¨å†Œçš„æœåŠ¡
print("å·²æ³¨å†ŒæœåŠ¡:", list(container._services.keys()))

# æŸ¥çœ‹å•ä¾‹å®ä¾‹
print("å•ä¾‹å®ä¾‹:", list(container._singletons.keys()))
```

#### 2. æ£€æŸ¥äº‹ä»¶å¤„ç†å™¨

```python
from nucleus import Myclass

# æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„ç±»
all_classes = Myclass.get_all_classes()
print("æ³¨å†Œçš„ç±»:", list(all_classes.keys()))

# æŸ¥çœ‹ç‰¹å®šäº‹ä»¶å¤„ç†å™¨
login_handlers = [name for name in all_classes.keys() if "user_login" in str(all_classes[name])]
print("ç™»å½•äº‹ä»¶å¤„ç†å™¨:", login_handlers)
```

#### 3. ä»»åŠ¡çŠ¶æ€æ£€æŸ¥

```python
task_manager = get_task_manager()

# è·å–æ‰€æœ‰ä»»åŠ¡çŠ¶æ€
all_tasks = task_manager.get_all_tasks_info()
for task in all_tasks:
    print(f"ä»»åŠ¡ {task['task_id']}: {task['status']}")

# è·å–ç»Ÿè®¡ä¿¡æ¯
stats = task_manager.get_statistics()
print(f"ä»»åŠ¡ç»Ÿè®¡: {stats}")
```

## 17. ç›¸å…³æ–‡æ¡£

- [APIå‚è€ƒæ–‡æ¡£](API_REFERENCE.md) - å®Œæ•´çš„APIæ–‡æ¡£
- [æœ€ä½³å®è·µæŒ‡å—](BEST_PRACTICES.md) - é«˜çº§ä½¿ç”¨æŠ€å·§
- [ç”Ÿäº§éƒ¨ç½²æŒ‡å—](PRODUCTION_DEPLOYMENT_GUIDE.md) - éƒ¨ç½²å’Œè¿ç»´æŒ‡å—
- [æµ‹è¯•è¿è¡ŒæŒ‡å—](RUN_TESTS.md) - æµ‹è¯•æ‰§è¡Œè¯´æ˜

## 18. è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## 19. è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE.txt) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## 20. æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥ [APIå‚è€ƒæ–‡æ¡£](API_REFERENCE.md)
3. è¿è¡Œæµ‹è¯•éªŒè¯æ¡†æ¶çŠ¶æ€
4. åœ¨GitHub Issuesä¸­å¯»æ±‚å¸®åŠ©

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStarï¼**

---

## 18. è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼

### ğŸ¯ è´¡çŒ®æ–¹å¼
- ğŸ› **æŠ¥å‘ŠBug**: åœ¨Issuesä¸­æŠ¥å‘Šå‘ç°çš„é—®é¢˜
- ğŸ’¡ **åŠŸèƒ½å»ºè®®**: æå‡ºæ–°åŠŸèƒ½æˆ–æ”¹è¿›å»ºè®®  
- ğŸ“ **æ–‡æ¡£æ”¹è¿›**: æ”¹è¿›æ–‡æ¡£æˆ–æ·»åŠ ç¤ºä¾‹
- ğŸ”§ **ä»£ç è´¡çŒ®**: æäº¤Pull Requestä¿®å¤é—®é¢˜æˆ–æ·»åŠ åŠŸèƒ½

### ğŸ“ è´¡çŒ®æ­¥éª¤
1. Fork é¡¹ç›®ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

### ğŸ“‹ ä»£ç è§„èŒƒ
- éµå¾ªPEP 8ç¼–ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„ç±»å‹æ³¨è§£
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## 21. æ›´æ–°æ—¥å¿—

### v2.4.0 (å½“å‰ç‰ˆæœ¬)
- âœ… **æ–°å¢**: å®Œæ•´çš„å‚æ•°è§£æç³»ç»Ÿæ–‡æ¡£
- âœ… **æ–°å¢**: æ™ºèƒ½å‚æ•°è§£æå™¨å®ç°å’Œç¤ºä¾‹
- âœ… **æ–°å¢**: é«˜çº§å‚æ•°è§£æç”¨æ³•å’Œæ•…éšœæ’é™¤æŒ‡å—
- âœ… **å¢å¼º**: @command_onè£…é¥°å™¨æ–‡æ¡£ï¼Œè¯¦ç»†è¯´æ˜arg_parserå‚æ•°
- âœ… **å¢å¼º**: å¿«é€Ÿå¼€å§‹ç¤ºä¾‹ï¼Œæ·»åŠ å‚æ•°è§£ææ¼”ç¤º
- âœ… **ä¿®å¤**: æ–‡æ¡£ç¼–å·å’Œæ ¼å¼é—®é¢˜

### v2.3.0 
- âœ… **æ–°å¢**: ä¾èµ–æ³¨å…¥ç³»ç»Ÿå®Œæ•´å®ç°
- âœ… **æ–°å¢**: è°ƒç”¨é“¾æ‹¦æˆªå™¨æ¨¡å¼
- âœ… **æ–°å¢**: ä»»åŠ¡ç®¡ç†å’Œä¼˜å…ˆçº§é˜Ÿåˆ—
- âœ… **æ–°å¢**: æ¡†æ¶é›†æˆå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… **æ–°å¢**: 44ä¸ªå®Œæ•´æµ‹è¯•ç”¨ä¾‹

### v2.2.0
- âœ… **æ–°å¢**: äº‹ä»¶è£…é¥°å™¨ç³»ç»Ÿ (@on, @command_on, @time_on, @re_on)
- âœ… **æ–°å¢**: å†·å´æ—¶é—´å’Œå‘½ä»¤åˆ«åæ”¯æŒ
- âœ… **æ–°å¢**: æ­£åˆ™è¡¨è¾¾å¼äº‹ä»¶åŒ¹é…
- âœ… **æ–°å¢**: å¼‚æ­¥/åŒæ­¥å‡½æ•°ç»Ÿä¸€æ”¯æŒ

### v2.1.0
- âœ… **æ–°å¢**: æœåŠ¡æ³¨å†Œå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… **æ–°å¢**: å•ä¾‹æ¨¡å¼æ”¯æŒ
- âœ… **æ–°å¢**: æ¥å£æ˜ å°„ç³»ç»Ÿ
- âœ… **æ–°å¢**: åŸºç¡€è£…é¥°å™¨åŠŸèƒ½

---

## 19. è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

### ğŸ“ è”ç³»æ–¹å¼
- **é¡¹ç›®ä¸»é¡µ**: [https://github.com/your-repo/decorator_framework](https://github.com/your-repo/decorator_framework)
- **é—®é¢˜åé¦ˆ**: [Issues](https://github.com/your-repo/decorator_framework/issues)
- **æ–‡æ¡£æ”¯æŒ**: [Wiki](https://github.com/your-repo/decorator_framework/wiki)

### ğŸ™ è‡´è°¢
æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œä½¿ç”¨è€…çš„æ”¯æŒï¼ç‰¹åˆ«æ„Ÿè°¢ä»¥ä¸‹è´¡çŒ®è€…ï¼š
- æ¡†æ¶æ ¸å¿ƒå¼€å‘å›¢é˜Ÿ
- æ–‡æ¡£ç¼–å†™å’Œç»´æŠ¤äººå‘˜
- æµ‹è¯•å’Œåé¦ˆæä¾›è€…

**è®©æˆ‘ä»¬ä¸€èµ·æ‰“é€ æ›´å¥½çš„Pythonä¼ä¸šçº§å¼€å‘æ¡†æ¶ï¼** ğŸš€